(()=>{var e,n={7575:(e,n,o)=>{const t=o(8625),r=o(9755);window.jQuery=r,window.SIP=t,r((function(){const e=o(2329).SDK,n=o(5049)||window.RingCentral.WebPhone;var t=null,l=null,i=null,c=0,a=null,s=null,u="",d=r("#app"),f=r("#template-login"),g=r("#template-auth-flow"),p=r("#template-call"),m=r("#template-incoming"),h=r("#template-accepted"),v=document.getElementById("remoteVideo"),b=document.getElementById("localVideo"),w=!0,y="";function S(e){return r(e.html())}function k(e,n,o,t,r,i,a){return c=a,localStorage.setItem("webPhoneServer",e||""),localStorage.setItem("webPhoneclientId",n||""),localStorage.setItem("webPhoneclientSecret",o||""),localStorage.setItem("webPhoneLogin",t||""),localStorage.setItem("webPhoneExtension",r||""),localStorage.setItem("webPhonePassword",i||""),localStorage.setItem("webPhoneLogLevel",c||0),l.get("/restapi/v1.0/account/~/extension/~").then((e=>e.json())).then((function(e){return s=e,console.log("Extension info",s),l.post("/restapi/v1.0/client-info/sip-provision",{sipInfo:[{transport:"WSS"}]})})).then((e=>e.json())).then(I).then(F).catch((function(e){console.error("Error in main promise chain"),console.error(e.stack||e)}))}function I(e){return i=new n(e,{enableDscp:!0,clientId:localStorage.getItem("webPhoneclientId"),audioHelper:{enabled:!0,incoming:"audio/incoming.ogg",outgoing:"audio/outgoing.ogg"},logLevel:parseInt(c,10),appName:"WebPhoneDemo",appVersion:"1.0.0",media:{remote:v,local:b},enableQos:!0,enableMediaReportLogging:!0}),window.webPhone=i,i.userAgent.audioHelper.setVolume(.3),i.userAgent.on("invite",P),i.userAgent.on("connecting",(function(){console.log("UA connecting")})),i.userAgent.on("connected",(function(){console.log("UA Connected")})),i.userAgent.on("disconnected",(function(){console.log("UA Disconnected")})),i.userAgent.on("registered",(function(){console.log("UA Registered")})),i.userAgent.on("unregistered",(function(){console.log("UA Unregistered")})),i.userAgent.on("registrationFailed",(function(){console.log("UA RegistrationFailed",arguments)})),i.userAgent.on("message",(function(){console.log("UA Message",arguments)})),i.userAgent.transport.on("switchBackProxy",(function(){console.log("switching back to primary outbound proxy"),i.userAgent.transport.reconnect(!0)})),i.userAgent.transport.on("closed",(function(){console.log("WebSocket closed.")})),i.userAgent.transport.on("transportError",(function(){console.log("WebSocket transportError occured")})),i.userAgent.transport.on("wsConnectionError",(function(){console.log("WebSocket wsConnectionError occured")})),i}function P(e){if(w=!1,console.log("EVENT: Invite",e.request),console.log("To",e.request.to.displayName,e.request.to.friendlyName),console.log("From",e.request.from.displayName,e.request.from.friendlyName),e.request.headers["Alert-Info"]&&"Auto Answer"===e.request.headers["Alert-Info"][0].raw)e.accept().then((function(){A(e)})).catch((function(e){console.error("Accept failed",e.stack||e)}));else{var n=S(m).modal({backdrop:"static"});n.find(".answer").on("click",(function(){n.find(".before-answer").css("display","none"),n.find(".answered").css("display",""),e.accept().then((function(){n.modal("hide"),A(e)})).catch((function(e){console.error("Accept failed",e.stack||e)}))})),n.find(".decline").on("click",(function(){e.reject(),n.modal("hide")})),n.find(".toVoicemail").on("click",(function(){e.toVoicemail(),n.modal("hide")})),n.find(".forward-form").on("submit",(function(o){o.preventDefault(),o.stopPropagation(),e.forward(n.find("input[name=forward]").val().trim()).then((function(){console.log("Forwarded"),n.modal("hide")})).catch((function(e){console.error("Forward failed",e.stack||e)}))})),n.find(".reply-form").on("submit",(function(o){o.preventDefault(),o.stopPropagation(),e.replyWithMessage({replyType:0,replyText:n.find("input[name=reply]").val()}).then((function(){console.log("Replied"),n.modal("hide")})).catch((function(e){console.error("Reply failed",e.stack||e)}))})),e.on("rejected",(function(){n.modal("hide")}))}}function A(e){console.log("EVENT: Accepted",e.request),console.log("To",e.request.to.displayName,e.request.to.friendlyName),console.log("From",e.request.from.displayName,e.request.from.friendlyName);var n=S(h).modal(),o=n.find(".info").eq(0),t=n.find("input[name=dtmf]").eq(0),r=n.find("input[name=transfer]").eq(0),c=n.find("input[name=flip]").eq(0),s=(n.find("input[name=conference]").eq(0),setInterval((function(){var n=e.startTime?Math.round((Date.now()-e.startTime)/1e3)+"s":"Ringing";o.text("time: "+n+"\nstartTime: "+JSON.stringify(e.startTime,null,2)+"\n")}),1e3));function u(){clearInterval(s),n.modal("hide")}n.find(".increase-volume").on("click",(function(){e.userAgent.audioHelper.setVolume((null!==e.userAgent.audioHelper.volume?e.userAgent.audioHelper.volume:.5)+.1)})),n.find(".decrease-volume").on("click",(function(){e.userAgent.audioHelper.setVolume((null!==e.userAgent.audioHelper.volume?e.userAgent.audioHelper.volume:.5)-.1)})),n.find(".mute").on("click",(function(){e.mute()})),n.find(".unmute").on("click",(function(){e.unmute()})),n.find(".hold").on("click",(function(){e.hold().then((function(){console.log("Holding")})).catch((function(e){console.error("Holding failed",e.stack||e)}))})),n.find(".unhold").on("click",(function(){e.unhold().then((function(){console.log("UnHolding")})).catch((function(e){console.error("UnHolding failed",e.stack||e)}))})),n.find(".startRecord").on("click",(function(){e.startRecord().then((function(){console.log("Recording Started")})).catch((function(e){console.error("Recording Start failed",e.stack||e)}))})),n.find(".stopRecord").on("click",(function(){e.stopRecord().then((function(){console.log("Recording Stopped")})).catch((function(e){console.error("Recording Stop failed",e.stack||e)}))})),n.find(".park").on("click",(function(){e.park().then((function(){console.log("Parked")})).catch((function(e){console.error("Park failed",e.stack||e)}))})),n.find(".transfer-form").on("submit",(function(o){o.preventDefault(),o.stopPropagation(),e.transfer(r.val().trim()).then((function(){console.log("Transferred"),n.modal("hide")})).catch((function(e){console.error("Transfer failed",e.stack||e)}))})),n.find(".transfer-form button.warm").on("click",(function(o){o.preventDefault(),o.stopPropagation(),e.hold().then((function(){console.log("Placing the call on hold, initiating attended transfer");var o=e.userAgent.invite(r.val().trim());o.once("established",(function(){console.log("New call initated. Click Complete to complete the transfer"),n.find(".transfer-form button.complete").on("click",(function(){e.warmTransfer(o).then((function(){console.log("Warm transfer completed")})).catch((function(e){console.error("Transfer failed",e.stack||e)}))}))}))}))})),n.find(".flip-form").on("submit",(function(n){n.preventDefault(),n.stopPropagation(),e.flip(c.val().trim()).then((function(){console.log("Flipped")})).catch((function(e){console.error("Flip failed",e.stack||e)})),c.val("")})),n.find(".dtmf-form").on("submit",(function(n){n.preventDefault(),n.stopPropagation(),e.dtmf(t.val().trim()),t.val("")})),n.find(".startConf").on("click",(function(e){O||l.get("/restapi/v1.0/account/~/extension/~/presence?detailedTelephonyState=true").then((e=>e.json())).then((e=>{var n=e.activeCalls[0].partyId,o=e.activeCalls[0].telephonySessionId;l.post("/restapi/v1.0/account/~/telephony/conference",{}).then((e=>e.json())).then((e=>(y=e.session.id,e.session.voiceCallToken))).then((e=>{!function(e,n,o){var t=i.userAgent.invite(e,{fromNumber:a});t.on("established",(function(){A(t),console.log("Conference call started"),function(e,n){var o="/restapi/v1.0/account/accountId/telephony/sessions/"+y+"/parties/bring-in";return l.post(o,{telephonySessionId:e,partyId:n})}(o,n).then((e=>e.json())).then((e=>{console.log("Adding call to conference succesful",e)})).catch((function(e){console.error("Conference call failed",e.stack||e)}))}))}(e,n,o),O=!0}))}))})),n.find(".hangup").on("click",(function(){e.dispose()})),e.on("established",(function(){console.log("Event: Established"),function(e){const n=w?"Outbound":"Inbound";var o={id:"",from:"",to:"",direction:"",sipData:{toTag:"",fromTag:""}};o.from=e.request.from.uri.user,o.to=e.request.to.uri.user,o.direction=n,o.id=e.dialog.id.callId,o.sipData.fromTag=e.dialog.remoteTag,o.sipData.toTag=e.dialog.localTag,localStorage.getItem("activeCallInfo")||localStorage.setItem("activeCallInfo",JSON.stringify(o))}(e)})),e.on("progress",(function(){console.log("Event: Progress")})),e.on("rejected",(function(){console.log("Event: Rejected"),u()})),e.on("failed",(function(){console.log("Event: Failed",arguments),u()})),e.on("terminated",(function(){console.log("Event: Terminated"),localStorage.setItem("activeCallInfo",""),u()})),e.on("cancel",(function(){console.log("Event: Cancel"),u()})),e.on("refer",(function(){console.log("Event: Refer"),u()})),e.on("replaced",(function(n){console.log("Event: Replaced: old session",e,"has been replaced with",n),u(),A(n)})),e.on("dtmf",(function(){console.log("Event: DTMF")})),e.on("muted",(function(){console.log("Event: Muted")})),e.on("unmuted",(function(){console.log("Event: Unmuted")})),e.on("connecting",(function(){console.log("Event: Connecting")})),e.on("bye",(function(){console.log("Event: Bye"),u()}))}var q,E,T,C,N,j,D,R,x,O=!1;function F(){var e=S(p),n=e.find("input[name=number]").eq(0),o=e.find("input[name=homeCountry]").eq(0),t=e.find(".username").eq(0),r=e.find(".logout").eq(0),l=e.find(".switch").eq(0);t.html("<dl><dt>Contact</dt><dd>"+s.contact.firstName+" "+s.contact.lastName+"</dd><dt>Company</dt><dd>"+(s.contact.company||"?")+"</dd><dt>From Phone Number</dt><dd>"+a+(""===u?"":"*"+u)+"</dd></dl>"),r.on("click",(function(e){i.userAgent.unregister(),e.preventDefault(),location.reload()})),l.on("click",(function(e){var n;n=JSON.parse(localStorage.getItem("activeCallInfo")),console.log("Switching active call to current tab: ",n),A(i.userAgent.switchFrom(n))})),n.val(localStorage.getItem("webPhoneLastNumber")||""),e.on("submit",(function(e){var t,r;e.preventDefault(),e.stopPropagation(),localStorage.setItem("webPhoneLastNumber",n.val()||""),t=n.val(),r=o.val(),w=!0,r=r||s&&s.regionalSettings&&s.regionalSettings.homeCountry&&s.regionalSettings.homeCountry.id||null,A(i.userAgent.invite(t,{fromNumber:a,homeCountryId:r}))})),d.empty().append(e)}q=S(f),E=S(g),T=E.find("input[name=server]").eq(0),C=E.find("input[name=clientId]").eq(0),N=E.find("input[name=clientSecret]").eq(0),j=q.find("input[name=username]").eq(0),D=q.find("input[name=extension]").eq(0),R=q.find("input[name=password]").eq(0),x=E.find("select[name=logLevel]").eq(0),T.val(localStorage.getItem("webPhoneServer")||e.server.sandbox),C.val(localStorage.getItem("webPhoneclientId")||""),N.val(localStorage.getItem("webPhoneclientSecret")||""),j.val(localStorage.getItem("webPhoneLogin")||""),D.val(localStorage.getItem("webPhoneExtension")||""),R.val(localStorage.getItem("webPhonePassword")||""),x.val(localStorage.getItem("webPhoneLogLevel")||c),q.on("submit",(function(n){var o,r,i,c,s,d,f;console.log("Normal Flow"),n.preventDefault(),n.stopPropagation(),o=T.val(),r=C.val(),i=N.val(),c=j.val(),s=D.val(),d=R.val(),f=x.val(),t=new e({clientId:r,clientSecret:i,server:o}),l=t.platform(),u=s,(a=c)&&(a=(a=a.match(/^[+1]/)?a:"1"+a).replace(/\W/g,"")),l.login({username:a,extension:s||null,password:d}).then((function(){return k(o,r,i,a,s,d,f)})).catch((function(e){console.error(e.stack||e)}))})),E.on("submit",(function(n){console.log("Authorized Flow"),n.preventDefault(),n.stopPropagation(),function(n,o,r,i){var c=decodeURIComponent(window.location.href.split("login",1)+"callback.html");console.log("The redirect uri value :",c),t=new e({clientId:o,clientSecret:r,server:n,redirectUri:c});var a=(l=t.platform()).loginUrl();l.loginWindow({url:a}).then(l.login.bind(l)).then((function(){return k(n,o,r,"","","",i)})).catch((function(e){console.error(e.stack||e)}))}(T.val(),C.val(),N.val(),x.val())})),d.empty().append(E).append(q)}))},5049:e=>{"use strict";e.exports=void 0},6601:()=>{},9214:()=>{},1922:()=>{},2363:()=>{},6419:()=>{},6353:()=>{},9386:()=>{},1616:()=>{},9862:()=>{},964:()=>{}},o={};function t(e){var r=o[e];if(void 0!==r)return r.exports;var l=o[e]={id:e,loaded:!1,exports:{}};return n[e].call(l.exports,l,l.exports,t),l.loaded=!0,l.exports}t.m=n,e=[],t.O=(n,o,r,l)=>{if(!o){var i=1/0;for(u=0;u<e.length;u++){for(var[o,r,l]=e[u],c=!0,a=0;a<o.length;a++)(!1&l||i>=l)&&Object.keys(t.O).every((e=>t.O[e](o[a])))?o.splice(a--,1):(c=!1,l<i&&(i=l));if(c){e.splice(u--,1);var s=r();void 0!==s&&(n=s)}}return n}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[o,r,l]},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),t.j=577,(()=>{var e={577:0};t.O.j=n=>0===e[n];var n=(n,o)=>{var r,l,[i,c,a]=o,s=0;if(i.some((n=>0!==e[n]))){for(r in c)t.o(c,r)&&(t.m[r]=c[r]);if(a)var u=a(t)}for(n&&n(o);s<i.length;s++)l=i[s],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(u)},o=self.webpackChunkringcentral_web_phone=self.webpackChunkringcentral_web_phone||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))})();var r=t.O(void 0,[948],(()=>t(7575)));r=t.O(r)})();
//# sourceMappingURL=demo.js.map